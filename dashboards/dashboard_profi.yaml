# ===========================================
# ğŸ”¥ VAILLANT PROFI-DASHBOARD
# Das ultimative Heizungs-Kontrollzentrum
# Erstellt von LISA fÃ¼r Murat ğŸ’™
# ===========================================
#
# FEATURES:
# - Echtzeit-Ãœberwachung aller Werte
# - Heizkurven-Visualisierung
# - Zirkulations-Monitoring
# - Brenner-Laufzeit-Analyse
# - Effizienz-Bewertung
# - Kostenprognose
# - Alarm-System
#
# ===========================================

title: Heizung Profi
views:
  # ==========================================
  # ğŸ›ï¸ HAUPTÃœBERSICHT - Alles auf einen Blick
  # ==========================================
  - title: Ãœbersicht
    path: uebersicht
    icon: mdi:view-dashboard
    type: sections
    sections:
      # --- HEADER STATUS ---
      - type: grid
        cards:
          - type: markdown
            content: |
              # ğŸ”¥ Vaillant Heizungs-Kontrollzentrum
              **Status:** {% if is_state('binary_sensor.ebusd_global_running', 'on') %}ğŸŸ¢ Online{% else %}ğŸ”´ Offline{% endif %} |
              **Heizkurve:** {{ states('sensor.ebusd_hc_heatingcurve') }} |
              **Pumpe:** {{ states('sensor.ebusd_bai_hcpumpmode') }}

      # --- TEMPERATUR GAUGES ---
      - type: grid
        cards:
          - type: gauge
            entity: sensor.heizung_vorlauf_celsius
            name: "ğŸŒ¡ï¸ Vorlauf"
            min: 20
            max: 80
            needle: true
            severity:
              green: 35
              yellow: 50
              red: 60
            segments:
              - from: 20
                color: '#43A047'
              - from: 40
                color: '#FFA726'
              - from: 55
                color: '#E53935'

          - type: gauge
            entity: sensor.heizung_soll_vorlauf_celsius
            name: "ğŸ¯ Soll-Vorlauf"
            min: 0
            max: 80
            needle: true

          - type: gauge
            entity: sensor.ebusd_hc_heatingcurve
            name: "ğŸ“ˆ Heizkurve"
            min: 0.5
            max: 2.0
            needle: true
            severity:
              green: 0.8
              yellow: 1.2
              red: 1.5

          - type: gauge
            entity: sensor.heizung_brenner_anteil_heute
            name: "âš¡ Brenner-Last"
            min: 0
            max: 100
            needle: true
            severity:
              green: 25
              yellow: 40
              red: 55

      # --- STATUS KARTEN ---
      - type: grid
        cards:
          - type: entity
            entity: binary_sensor.ebusd_global_running
            name: "eBUS Status"
            icon: mdi:connection

          - type: entity
            entity: binary_sensor.ebusd_hwc_status_onoff
            name: "Warmwasser"
            icon: mdi:water-boiler

          - type: entity
            entity: sensor.ebusd_bai_displaymode
            name: "Display"

          - type: entity
            entity: sensor.ebusd_bai_hcpumpmode
            name: "Pumpen-Modus"

  # ==========================================
  # ğŸŒ¡ï¸ TEMPERATUREN - Detaillierte Ansicht
  # ==========================================
  - title: Temperaturen
    path: temperaturen
    icon: mdi:thermometer
    cards:
      - type: markdown
        content: "# ğŸŒ¡ï¸ Temperatur-Ãœbersicht"

      # Haupt-Temperaturen Karte
      - type: entities
        title: "ğŸ“Š Aktuelle Temperaturen"
        state_color: true
        entities:
          - entity: sensor.heizung_vorlauf_celsius
            name: "ğŸ”´ Vorlauf (aktuell)"
            icon: mdi:thermometer-high
          - entity: sensor.heizung_soll_vorlauf_celsius
            name: "ğŸ¯ Vorlauf (Soll)"
            icon: mdi:thermometer-check
          - type: divider
          - entity: sensor.ebusd_bai_flowtempmax
            name: "â¬†ï¸ Vorlauf Maximum"
          - entity: sensor.ebusd_hc_flowtempmin
            name: "â¬‡ï¸ Vorlauf Minimum"
          - type: divider
          - entity: sensor.ebusd_hwc_hwctemp_temp
            name: "ğŸš¿ Warmwasser"
            icon: mdi:water-thermometer
          - entity: sensor.ebusd_hwc_hwctempmax
            name: "ğŸš¿ Warmwasser Max"

      # Temperatur-Verlauf Grafik
      - type: history-graph
        title: "ğŸ“ˆ Temperaturverlauf (24h)"
        hours_to_show: 24
        refresh_interval: 120
        entities:
          - entity: sensor.heizung_vorlauf_celsius
            name: "Vorlauf"
          - entity: sensor.heizung_soll_vorlauf_celsius
            name: "Soll"

      # Statistik
      - type: horizontal-stack
        cards:
          - type: statistic
            entity: sensor.heizung_vorlauf_celsius
            name: "Ã˜ Heute"
            period:
              calendar:
                period: day
            stat_type: mean

          - type: statistic
            entity: sensor.heizung_vorlauf_celsius
            name: "Max Heute"
            period:
              calendar:
                period: day
            stat_type: max

          - type: statistic
            entity: sensor.heizung_vorlauf_celsius
            name: "Min Heute"
            period:
              calendar:
                period: day
            stat_type: min

  # ==========================================
  # ğŸ“ˆ HEIZKURVE - Analyse & Optimierung
  # ==========================================
  - title: Heizkurve
    path: heizkurve
    icon: mdi:chart-bell-curve-cumulative
    cards:
      - type: markdown
        content: |
          # ğŸ“ˆ Heizkurven-Analyse

          **Deine aktuelle Heizkurve:** {{ states('sensor.ebusd_hc_heatingcurve') }}

          ---

          ## Was bedeutet die Heizkurve?

          Die Heizkurve bestimmt die **Vorlauftemperatur** abhÃ¤ngig von der **AuÃŸentemperatur**:

          | AuÃŸentemp | Heizkurve 1.0 | Heizkurve 1.3 (DEIN WERT) | Heizkurve 1.5 |
          |-----------|---------------|---------------------------|---------------|
          | +10Â°C | ~30Â°C | ~35Â°C | ~38Â°C |
          | +5Â°C | ~38Â°C | ~43Â°C | ~48Â°C |
          | 0Â°C | ~45Â°C | ~52Â°C | ~58Â°C |
          | -5Â°C | ~52Â°C | ~60Â°C | ~68Â°C |
          | -10Â°C | ~60Â°C | ~70Â°C | ~78Â°C |

          **Dein saniertes Haus braucht ca. 0.8-1.0!**

      - type: entities
        title: "âš™ï¸ Heizkurven-Einstellungen"
        entities:
          - entity: sensor.ebusd_hc_heatingcurve
            name: "ğŸ“ˆ Aktuelle Heizkurve"
            icon: mdi:chart-line
          - entity: sensor.ebusd_hc_flowtempdesired
            name: "ğŸ¯ Berechneter Soll-Vorlauf"
          - entity: sensor.ebusd_hc_flowtempmax
            name: "â¬†ï¸ Max. erlaubter Vorlauf"
          - entity: sensor.ebusd_hc_flowtempmin
            name: "â¬‡ï¸ Min. erlaubter Vorlauf"

      - type: history-graph
        title: "ğŸ“Š Heizkurve Ã¼ber Zeit"
        hours_to_show: 168
        entities:
          - entity: sensor.ebusd_hc_heatingcurve
            name: "Heizkurve"

      # Empfehlungs-Box
      - type: markdown
        content: |
          ## ğŸ’¡ Empfehlung fÃ¼r dein Haus

          | Haustyp | Empfohlene Heizkurve |
          |---------|---------------------|
          | Neubau/Passivhaus | 0.4 - 0.6 |
          | **Saniert (DU!)** | **0.8 - 1.0** |
          | Altbau normal | 1.2 - 1.4 |
          | Altbau unsaniert | 1.5 - 1.8 |

          **Dein Wert (1.3) ist zu hoch!** â†’ Nach Baseline-Messung auf **1.0** reduzieren!

  # ==========================================
  # ğŸ”„ ZIRKULATION & PUMPE
  # ==========================================
  - title: Zirkulation
    path: zirkulation
    icon: mdi:pump
    cards:
      - type: markdown
        content: "# ğŸ”„ Zirkulation & Pumpen-Status"

      - type: entities
        title: "ğŸ’§ Pumpen-Status"
        state_color: true
        entities:
          - entity: sensor.ebusd_bai_hcpumpmode
            name: "ğŸ”„ Heizkreis-Pumpe Modus"
            icon: mdi:pump
          - entity: sensor.ebusd_bai_hcpumpstarts
            name: "ğŸ”¢ Pumpen-Starts gesamt"
          - type: divider
          - entity: binary_sensor.ebusd_hwc_status_onoff
            name: "ğŸš¿ Warmwasser-Zirkulation"
          - entity: sensor.ebusd_bai_hwchours
            name: "â±ï¸ WW-Betriebsstunden"
          - entity: sensor.ebusd_bai_hwcstarts
            name: "ğŸ”¢ WW-Starts gesamt"

      - type: history-graph
        title: "ğŸ“Š Warmwasser-AktivitÃ¤t (24h)"
        hours_to_show: 24
        entities:
          - entity: binary_sensor.ebusd_hwc_status_onoff
            name: "Warmwasser aktiv"

      - type: markdown
        content: |
          ## ğŸ’¡ Zirkulations-Tipps

          **Weniger Zirkulation = Weniger Energieverlust!**

          - Warmwasser nur zu StoÃŸzeiten zirkulieren (morgens, abends)
          - Zirkulationsleitung dÃ¤mmen
          - Timer fÃ¼r Zirkulationspumpe nutzen

  # ==========================================
  # âš¡ BRENNER-ANALYSE
  # ==========================================
  - title: Brenner
    path: brenner
    icon: mdi:fire
    cards:
      - type: markdown
        content: "# âš¡ Brenner-Analyse"

      - type: horizontal-stack
        cards:
          - type: entity
            entity: sensor.heizung_brenner_laufzeit_heute
            name: "Heute"
            icon: mdi:clock

          - type: entity
            entity: sensor.heizung_brenner_laufzeit_gestern
            name: "Gestern"
            icon: mdi:clock-outline

          - type: entity
            entity: sensor.heizung_brenner_anteil_heute
            name: "Anteil %"
            icon: mdi:percent

      - type: entities
        title: "ğŸ“Š Betriebsstunden"
        entities:
          - entity: sensor.ebusd_bai_fanhours
            name: "ğŸŒ€ LÃ¼fter-Stunden gesamt"
            icon: mdi:fan
          - entity: sensor.ebusd_bai_hchours
            name: "ğŸ”¥ Heizkreis-Stunden gesamt"
            icon: mdi:fire
          - entity: sensor.ebusd_bai_hcstarts
            name: "ğŸ”„ Heizkreis-Starts gesamt"
            icon: mdi:counter
          - type: divider
          - entity: sensor.heizung_starts_taeglich
            name: "ğŸ“… Starts heute"
          - entity: sensor.heizung_starts_woechentlich
            name: "ğŸ“… Starts diese Woche"

      - type: history-graph
        title: "ğŸ“ˆ Brenner-AktivitÃ¤t (24h)"
        hours_to_show: 24
        entities:
          - entity: sensor.heizung_brenner_aktiv
            name: "Brenner"

      - type: markdown
        content: |
          ## ğŸ’¡ Brenner-Optimierung

          **Ziel: Wenige, lange BrennerlÃ¤ufe statt viele kurze!**

          | Messwert | Optimal | Schlecht |
          |----------|---------|----------|
          | Starts/Tag | < 10 | > 20 |
          | Laufzeit/Start | > 15 Min | < 5 Min |
          | Tages-Anteil | 20-35% | > 50% |

          **Viele kurze Starts = Takten = Ineffizient & VerschleiÃŸ!**

  # ==========================================
  # ğŸ’° KOSTEN & EFFIZIENZ
  # ==========================================
  - title: Effizienz
    path: effizienz
    icon: mdi:currency-eur
    cards:
      - type: markdown
        content: |
          # ğŸ’° Effizienz & Kostenanalyse

          **Jedes Grad weniger Vorlauf = 2-3% weniger Gaskosten!**

      - type: horizontal-stack
        cards:
          - type: gauge
            entity: sensor.heizung_vorlauf_24h_durchschnitt
            name: "Ã˜ Vorlauf"
            min: 25
            max: 70
            needle: true
            severity:
              green: 40
              yellow: 50
              red: 60

          - type: gauge
            entity: sensor.ebusd_hc_heatingcurve
            name: "Heizkurve"
            min: 0.5
            max: 2.0
            severity:
              green: 1.0
              yellow: 1.3
              red: 1.5

      - type: markdown
        content: |
          ## ğŸ“Š Deine Effizienz-Bewertung

          | Parameter | Wert | Bewertung |
          |-----------|------|-----------|
          | Heizkurve | {{ states('sensor.ebusd_hc_heatingcurve') }} | {% if states('sensor.ebusd_hc_heatingcurve')|float <= 1.0 %}âœ… Optimal{% elif states('sensor.ebusd_hc_heatingcurve')|float <= 1.3 %}âš ï¸ Zu hoch{% else %}âŒ Viel zu hoch{% endif %} |
          | Ã˜ Vorlauf 24h | {{ states('sensor.heizung_vorlauf_24h_durchschnitt')|round(1) }}Â°C | {% if states('sensor.heizung_vorlauf_24h_durchschnitt')|float <= 42 %}âœ… Optimal{% elif states('sensor.heizung_vorlauf_24h_durchschnitt')|float <= 50 %}âš ï¸ Etwas hoch{% else %}âŒ Zu hoch{% endif %} |
          | Brenner % | {{ states('sensor.heizung_brenner_anteil_heute')|round(0) }}% | {% if states('sensor.heizung_brenner_anteil_heute')|float <= 30 %}âœ… Sparsam{% elif states('sensor.heizung_brenner_anteil_heute')|float <= 45 %}âš ï¸ Normal{% else %}âŒ Zu viel{% endif %} |

          ---

          ## ğŸ’¡ GeschÃ¤tztes Einsparpotential

          Bei Reduzierung der Heizkurve von **1.3 auf 1.0**:

          - Vorlauf-Reduktion: ca. **8-10Â°C**
          - Erwartete Ersparnis: ca. **15-25%**
          - Bei 2000â‚¬/Jahr Gas: ca. **300-500â‚¬ sparen!**

  # ==========================================
  # â° ZEITPROGRAMME
  # ==========================================
  - title: Zeitprogramme
    path: zeiten
    icon: mdi:clock-outline
    cards:
      - type: markdown
        content: "# â° Heizzeiten & Programme"

      - type: entities
        title: "ğŸ“… Wochenprogramm Heizkreis"
        entities:
          - entity: sensor.ebusd_hc_timer_monday_daysel
            name: "Montag"
          - entity: sensor.ebusd_hc_timer_tuesday_daysel
            name: "Dienstag"
          - entity: sensor.ebusd_hc_timer_wednesday_daysel
            name: "Mittwoch"
          - entity: sensor.ebusd_hc_timer_thursday_daysel
            name: "Donnerstag"
          - entity: sensor.ebusd_hc_timer_friday_daysel
            name: "Freitag"
          - entity: sensor.ebusd_hc_timer_saturday_daysel
            name: "Samstag"
          - entity: sensor.ebusd_hc_timer_sunday_daysel
            name: "Sonntag"

      - type: entities
        title: "ğŸŒ¡ï¸ Temperatur-Einstellungen"
        entities:
          - entity: sensor.ebusd_hc_tempdesired
            name: "ğŸ”¥ Soll-Raumtemperatur (Heizen)"
          - entity: sensor.ebusd_hc_tempdesiredlow
            name: "â„ï¸ Absenktemperatur (Nacht/Eco)"
          - entity: sensor.ebusd_hc_operatingmode
            name: "âš™ï¸ Betriebsmodus"

  # ==========================================
  # ğŸ”§ SYSTEM & DIAGNOSE
  # ==========================================
  - title: System
    path: system
    icon: mdi:cog
    cards:
      - type: markdown
        content: "# ğŸ”§ System & Diagnose"

      - type: entities
        title: "ğŸ“¡ Verbindungsstatus"
        state_color: true
        entities:
          - entity: binary_sensor.ebusd_global_running
            name: "eBUS Daemon"
          - entity: binary_sensor.ebusd_global_signal
            name: "eBUS Signal"

      - type: entities
        title: "ğŸ“Š System-Statistiken"
        entities:
          - entity: sensor.ebusd_bai_fanhours
            name: "LÃ¼fter Gesamt-Stunden"
          - entity: sensor.ebusd_bai_fanstarts
            name: "LÃ¼fter Gesamt-Starts"
          - entity: sensor.ebusd_bai_hchours
            name: "Heizkreis Gesamt-Stunden"
          - entity: sensor.ebusd_bai_hcstarts
            name: "Heizkreis Gesamt-Starts"
          - type: divider
          - entity: sensor.ebusd_hc_statoperatinghours
            name: "Regler Betriebsstunden"
          - entity: sensor.ebusd_hc_statrestarts
            name: "Regler Neustarts"

      - type: entities
        title: "ğŸ”§ Service-Info"
        entities:
          - entity: sensor.ebusd_bai_hourstillservice
            name: "Stunden bis Service"
          - entity: sensor.ebusd_bai_maintenancedata_hwc
            name: "Wartungsdaten WW"

      - type: markdown
        content: |
          ## ğŸ’¡ Wartungs-Hinweise

          - **JÃ¤hrliche Wartung** durch Fachmann empfohlen
          - **Wasserdruck** regelmÃ¤ÃŸig prÃ¼fen (1.5-2.0 bar)
          - **Filter** in RÃ¼cklauf regelmÃ¤ÃŸig reinigen
          - **EntlÃ¼ften** der HeizkÃ¶rper vor Heizsaison
